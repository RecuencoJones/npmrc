dist: trusty
language: go
go:
- "1.10"

install:
- go get github.com/mitchellh/gox
- go get -t ./...

script:
- go install ./...
- gox -output="bin/{{.Dir}}_{{.OS}}_{{.Arch}}" ./...

before_deploy:
- export VERSION=`npmrc version`

deploy:
  provider: releases
  api_key: $GITHUB_TOKEN
  file_glob: true
  file: bin/**/*
  skip_cleanup: true
  name: npmrc $VERSION
  body: 'Follow these steps:\n- Download the binary for your distribution\n- Rename it to `npmrc`\n- Make it available in your path\n\nHappy npmrc switching! :)'
  on:
    tags: true
